# å‰ç«¯æ¶ˆæ¯åè®®æ¸²æŸ“å®ç°

> **æ—¥æœŸ**: 2026-01-25
> **ç›®æ ‡**: ç«¯åˆ°ç«¯æµ‹è¯•å‰ç«¯èƒ½å¦æ­£ç¡®å±•ç¤ºæ¶ˆæ¯åè®®æ¸²æŸ“

---

## 1. æ¦‚è¿°

### 1.1 æ¶ˆæ¯åè®®äº‹ä»¶

åç«¯å‘é€çš„äº‹ä»¶ç±»å‹ï¼š

| äº‹ä»¶ç±»å‹ | ç”¨é€” | å‰ç«¯åŠ¨ä½œ |
|---------|------|---------|
| `message:content` | æµå¼å†…å®¹è¾“å‡º | æ¸²æŸ“æ–‡æœ¬æ¶ˆæ¯ |
| `message:metadata` | å…ƒæ•°æ®/åŒ»ç–—å»ºè®® | æ¸²æŸ“åŒ»ç–—å»ºè®®å¡ç‰‡ |
| `tool:call` | å·¥å…·è°ƒç”¨çŠ¶æ€ | å¯é€‰ï¼šæ˜¾ç¤ºåŠ è½½çŠ¶æ€ |

### 1.2 å½“å‰çŠ¶æ€

| åŠŸèƒ½ | çŠ¶æ€ |
|-----|------|
| æ–‡æœ¬æ¶ˆæ¯æ¸²æŸ“ | âœ… å·²å®Œæˆ |
| æµå¼è¾“å‡ºåŠ¨ç”» | âœ… å·²å®Œæˆ |
| ç´§æ€¥ç¨‹åº¦è­¦å‘Š | âœ… å·²å®Œæˆ |
| å¿«æ·æ“ä½œæŒ‰é’® | âœ… å·²å®Œæˆ |
| åŒ»ç–—å»ºè®®å¡ç‰‡ | â³ å¾…å®ç° |

---

## 2. åŒ»ç–—å»ºè®®å¡ç‰‡è®¾è®¡

### 2.1 ç»„ä»¶ç»“æ„

```
MessageRenderer.tsx
â”œâ”€â”€ TextMessage          # æ–‡æœ¬æ¶ˆæ¯
â”œâ”€â”€ ImageMessage         # å›¾ç‰‡æ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ SystemMessage        # ç³»ç»Ÿæ¶ˆæ¯
â”œâ”€â”€ MedicalAdviceCard    # æ–°å¢ï¼šåŒ»ç–—å»ºè®®å¡ç‰‡
â””â”€â”€ MessagesList         # æ‰¹é‡æ¶ˆæ¯æ¸²æŸ“
```

### 2.2 åŒ»ç–—å»ºè®®æ•°æ®ç»“æ„

```typescript
interface MedicalAdvice {
  symptoms: string[];           // å¯èƒ½ç—‡çŠ¶
  possibleConditions: string[]; // å¯èƒ½æƒ…å†µ
  suggestions: string[];        // å»ºè®®
  urgencyLevel: 'low' | 'medium' | 'high'; // ç´§æ€¥ç¨‹åº¦
}
```

### 2.3 UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ å¥åº·å»ºè®®                    [å»ºè®®å…³æ³¨] â”‚  â† ç´§æ€¥ç¨‹åº¦æ ‡ç­¾
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯èƒ½ç—‡çŠ¶                            â”‚
â”‚ ğŸ”µ å‘çƒ­ ğŸ”µ å¤´ç—› ğŸ”µ ä¹åŠ›              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯èƒ½æƒ…å†µ                            â”‚
â”‚ ğŸ”µ ä¸Šå‘¼å¸é“æ„ŸæŸ“ ğŸ”µ æµæ„Ÿ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å»ºè®®                                â”‚
â”‚ â€¢ å¤šä¼‘æ¯                            â”‚
â”‚ â€¢ å¤šå–æ°´                            â”‚
â”‚ â€¢ å¿…è¦æ—¶å°±åŒ»                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. å®ç°è®¡åˆ’

### Task 1: æ·»åŠ  MedicalAdviceCard ç»„ä»¶

**æ–‡ä»¶**: `frontend/src/components/message/MessageRenderer.tsx`

**å†…å®¹**:
- åˆ›å»º `MedicalAdviceCard` ç»„ä»¶
- æ ¹æ® `urgencyLevel` æ˜¾ç¤ºä¸åŒé¢œè‰²
- æ˜¾ç¤ºç—‡çŠ¶ã€å¯èƒ½æƒ…å†µã€å»ºè®®åˆ—è¡¨

### Task 2: æ›´æ–° MessageRenderer

**æ–‡ä»¶**: `frontend/src/components/message/MessageRenderer.tsx`

**å†…å®¹**:
- åœ¨ `MessageRenderer` ä¸­æ·»åŠ åŒ»ç–—å»ºè®®å¡ç‰‡æ¸²æŸ“
- ä¼ é€’ `medicalAdvice` æ•°æ®åˆ°å¡ç‰‡ç»„ä»¶

### Task 3: æ·»åŠ å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `frontend/tests/unit/medicalAdvice.test.tsx`

**æµ‹è¯•åœºæ™¯**:
- ä¸åŒç´§æ€¥ç¨‹åº¦çš„é¢œè‰²æ˜¾ç¤º
- ç©ºæ•°æ®ä¸æ¸²æŸ“
- æ•°æ®æ­£ç¡®æ¸²æŸ“

### Task 4: æ›´æ–° E2E æµ‹è¯•

**æ–‡ä»¶**: `frontend/tests/e2e/chat.spec.ts`

**æ–°å¢æµ‹è¯•**:
- éªŒè¯åŒ»ç–—å»ºè®®å¡ç‰‡æ˜¾ç¤º
- éªŒè¯ç´§æ€¥ç¨‹åº¦é¢œè‰²

---

## 4. æµ‹è¯•éªŒè¯

### 4.1 è¿è¡Œæµ‹è¯•

```bash
# å‰ç«¯å•å…ƒæµ‹è¯•
cd frontend
pnpm test:unit

# å‰ç«¯ E2E æµ‹è¯•
pnpm test:e2e

# åŒæ—¶è¿è¡Œ
pnpm test
```

### 4.2 éªŒè¯é¡¹

| éªŒè¯é¡¹ | æµ‹è¯•ç±»å‹ |
|-------|---------|
| åŒ»ç–—å»ºè®®å¡ç‰‡æ­£ç¡®æ¸²æŸ“ | E2E + Unit |
| ç´§æ€¥ç¨‹åº¦é¢œè‰²æ­£ç¡® | Unit |
| ç©ºæ•°æ®æ—¶ä¸æ¸²æŸ“å¡ç‰‡ | Unit |
| æ¶ˆæ¯å†…å®¹æ­£ç¡®æ˜¾ç¤º | E2E |
| æ“ä½œæŒ‰é’®æ­£ç¡®æ˜¾ç¤º | E2E |

---

## 5. é£é™©ä¸ç¼“è§£

| é£é™© | ç¼“è§£æªæ–½ |
|-----|---------|
| åç«¯ medicalAdvice æ•°æ®ä¸ºç©º | æ·»åŠ ç©ºå€¼æ£€æŸ¥ |
| æ ·å¼ä¸ç°æœ‰ç»„ä»¶å†²çª | ä½¿ç”¨ Tailwind éš”ç¦»æ ·å¼ |
| æµ‹è¯•ç¯å¢ƒé…ç½®å¤æ‚ | ä½¿ç”¨ Playwright å›ºå®šç‰ˆæœ¬ |
