# ä¸“å®¶é—®è¯Šæ¨¡å—è®¾è®¡æ–‡æ¡£

**æ¨¡å—åç§°**: ä¸“å®¶é—®è¯Š
**åˆ›å»ºæ—¥æœŸ**: 2026-01-25
**ç‰ˆæœ¬**: v1.0

---

## 1. æ•´ä½“æ¶æ„

### 1.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          React H5 å‰ç«¯                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŒ»ç”Ÿåˆ—è¡¨é¡µ   â”‚  â”‚  ä¸“å®¶é—®è¯ŠèŠå¤©é¡µ  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŒ»ç”Ÿå¾…åŠé¡µ   â”‚  â”‚  WebSocketæœåŠ¡   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ WebSocket / REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Express åç«¯æœåŠ¡                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ REST API                        â”‚   â”‚
â”‚  â”‚ - åŒ»ç”Ÿåˆ—è¡¨/è¯¦æƒ…                  â”‚   â”‚
â”‚  â”‚ - å‘èµ·/æ¥è¯Š/ç»“æŸé—®è¯Š             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ WebSocket Server                â”‚   â”‚
â”‚  â”‚ - å®æ—¶æ¶ˆæ¯æ¨é€                   â”‚   â”‚
â”‚  â”‚ - å¿ƒè·³æ£€æµ‹                       â”‚   â”‚
â”‚  â”‚ - ä¼šè¯ç®¡ç†                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   å†…å­˜å­˜å‚¨       â”‚
        â”‚ (MVPé˜¶æ®µ)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç”¨æˆ·è§’è‰²

| è§’è‰² | æƒé™ | é¡µé¢ |
|-----|------|------|
| æ‚£è€… | æµè§ˆåŒ»ç”Ÿã€å‘èµ·é—®è¯Šã€å®æ—¶èŠå¤© | åŒ»ç”Ÿåˆ—è¡¨é¡µã€ä¸“å®¶é—®è¯ŠèŠå¤©é¡µ |
| åŒ»ç”Ÿ | æŸ¥çœ‹å¾…åŠã€æ¥è¯Šé—®è¯Šã€å®æ—¶èŠå¤© | åŒ»ç”Ÿå¾…åŠé¡µã€ä¸“å®¶é—®è¯ŠèŠå¤©é¡µ |

---

## 2. API è®¾è®¡

### 2.1 REST API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | æƒé™ |
|-----|------|------|------|
| GET | `/api/consultations/doctors` | è·å–åŒ»ç”Ÿåˆ—è¡¨ | æ‚£è€…/åŒ»ç”Ÿ |
| GET | `/api/consultations/doctors/:id` | è·å–åŒ»ç”Ÿè¯¦æƒ… | æ‚£è€…/åŒ»ç”Ÿ |
| GET | `/api/consultations/departments` | è·å–ç§‘å®¤åˆ—è¡¨ | å…¬å¼€ |
| POST | `/api/consultations` | å‘èµ·é—®è¯Š | æ‚£è€… |
| GET | `/api/consultations` | è·å–é—®è¯Šåˆ—è¡¨ | æ‚£è€…/åŒ»ç”Ÿ |
| GET | `/api/consultations/:id` | è·å–é—®è¯Šè¯¦æƒ… | å‚ä¸åŒæ–¹ |
| PUT | `/api/consultations/:id/accept` | åŒ»ç”Ÿæ¥è¯Š | åŒ»ç”Ÿ |
| PUT | `/api/consultations/:id/close` | ç»“æŸé—®è¯Š | åŒ»ç”Ÿ |

### 2.2 WebSocket æ¶ˆæ¯åè®®

**å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯**

```typescript
type ClientMessage =
  | { type: 'join'; conversationId: string }
  | { type: 'leave'; conversationId: string }
  | { type: 'message'; conversationId: string; content: string }
  | { type: 'typing'; conversationId: string; isTyping: boolean }
  | { type: 'heartbeat' };
```

**æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯**

```typescript
type ServerMessage =
  | { type: 'message'; conversationId: string; message: ChatMessage }
  | { type: 'typing'; conversationId: string; senderId: string }
  | { type: 'system'; conversationId: string; text: string }
  | { type: 'joined'; conversationId: string }
  | { type: 'left'; conversationId: string };

interface ChatMessage {
  id: string;
  senderId: string;
  senderType: 'patient' | 'doctor';
  content: string;
  createdAt: string;
}
```

### 2.3 WebSocket è¿æ¥æµç¨‹

```
1. å‰ç«¯ï¼šnew WebSocket(`ws://host/ws?token=${jwtToken}`)
2. åç«¯ï¼šéªŒè¯ JWT Tokenï¼Œè·å–ç”¨æˆ·è§’è‰²å’Œ userId
3. è¿æ¥æˆåŠŸï¼Œå‘é€ { type: 'system', text: 'Connected' }
4. åŠ å…¥ä¼šè¯ï¼šå‘é€ { type: 'join', conversationId: 'xxx' }
5. å¼€å§‹æ”¶å‘æ¶ˆæ¯
6. ç¦»å¼€ä¼šè¯ï¼šå‘é€ { type: 'leave', conversationId: 'xxx' }
```

---

## 3. æ•°æ®æ¨¡å‹

### 3.1 é—®è¯Šä¼šè¯

```typescript
interface Consultation {
  id: string;
  patientId: string;
  patientPhone: string;
  doctorId: string;
  status: 'pending' | 'active' | 'closed';
  createdAt: string;
  updatedAt: string;
}
```

### 3.2 æ¶ˆæ¯

```typescript
interface Message {
  id: string;
  conversationId: string;
  senderId: string;
  senderType: 'patient' | 'doctor';
  content: string;
  createdAt: string;
}
```

### 3.3 åŒ»ç”Ÿ

```typescript
interface Doctor {
  id: string;
  userId: string;
  name: string;
  title: string;
  department: string;
  hospital: string;
  avatarUrl?: string;
  consultationFee: number;
  isAvailable: boolean;
}
```

---

## 4. å‰ç«¯é¡µé¢è®¾è®¡

### 4.1 åŒ»ç”Ÿåˆ—è¡¨é¡µ `/doctor-list`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å›      é€‰æ‹©ç§‘å®¤    ğŸ”æœç´¢   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¨éƒ¨] [å†…ç§‘] [å¤–ç§‘] [å„¿ç§‘] ...  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ å¼ åŒ»ç”Ÿ                    â”‚ â”‚
â”‚ â”‚ ä¸‰ç”²åŒ»é™¢ | å¿ƒå†…ç§‘ | ä¸»ä»»åŒ»å¸ˆ   â”‚ â”‚
â”‚ â”‚ é—®è¯Šé‡ 500+ | å“åº”å¿«          â”‚ â”‚
â”‚ â”‚ Â¥29/æ¬¡                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ä¸“å®¶é—®è¯ŠèŠå¤©é¡µ `/doctor-chat/:id`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å›      ğŸ‘¤ å¼ åŒ»ç”Ÿ    â‹®æ›´å¤š   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ä»Šå¤© 10:30              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä½ å¥½ï¼Œæˆ‘æœ€è¿‘èƒ¸é—·...              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            å·²è¯»                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‚¨å¥½ï¼Œè¯·é—®æŒç»­å¤šä¹…äº†ï¼Ÿ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æ­£åœ¨è¾“å…¥...             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è¾“å…¥æ¶ˆæ¯...               â”‚ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    ğŸ“· å‘é€                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 åŒ»ç”Ÿå¾…åŠé¡µ `/doctor/tasks`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å›      å¾…åŠé—®è¯Š             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ æ‚£è€… 138****8888          â”‚ â”‚
â”‚ â”‚ "æˆ‘å¤´ç–¼å‘çƒ§..."              â”‚ â”‚
â”‚ â”‚ 10:30                        â”‚ â”‚
â”‚ â”‚            [æ¥è¯Š]            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. å®ç°æ­¥éª¤

### åç«¯å®ç°

1. `backend/src/services/storage/doctorStore.ts` - åŒ»ç”Ÿæ•°æ® Mock + ç§‘å®¤åˆ—è¡¨
2. `backend/src/services/storage/messageStore.ts` - æ¶ˆæ¯å­˜å‚¨
3. `backend/src/services/storage/consultationStore.ts` - é—®è¯Šä¼šè¯å­˜å‚¨
4. `backend/src/controllers/consultationController.ts` - å¢åŠ æ¥è¯Š/ç»“æŸ API
5. `backend/src/services/websocket/WebSocketManager.ts` - æ”¯æŒ join/leave
6. `backend/src/routes/consultations.ts` - æ–°å¢è·¯ç”±

### å‰ç«¯å®ç°

1. `frontend/src/services/websocket.ts` - WebSocket æœåŠ¡å°è£…
2. `frontend/src/pages/DoctorList/index.tsx` - åŒ»ç”Ÿåˆ—è¡¨é¡µ
3. `frontend/src/pages/DoctorChat/index.tsx` - ä¸“å®¶é—®è¯ŠèŠå¤©é¡µ
4. `frontend/src/pages/DoctorTasks/index.tsx` - åŒ»ç”Ÿå¾…åŠé¡µ
5. `frontend/src/router.tsx` - æ›´æ–°è·¯ç”±
6. `frontend/src/pages/Login/index.tsx` - æ”¯æŒè§’è‰²é€‰æ‹©

---

## 6. æ³¨æ„äº‹é¡¹

1. MVP é˜¶æ®µæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒæœåŠ¡é‡å¯ä¼šä¸¢å¤±
2. WebSocket å¿ƒè·³é—´éš” 30 ç§’ï¼Œè¶…æ—¶ 60 ç§’æ–­å¼€
3. æ¶ˆæ¯é™æµï¼šæ¯åˆ†é’Ÿæœ€å¤š 60 æ¡
4. åç»­å¯è¿ç§»åˆ° Supabase PostgreSQL æŒä¹…åŒ–å­˜å‚¨
